======================================================================
GAMECREATOR NETCODE - NETWORK MODULE SCHEMA
======================================================================
Project: ML - GameCreator Core + Netcode
Generated: 2025-12-03
Assembly: GameCreator.Netcode.Runtime
Namespace: GameCreator.Netcode.Runtime

----------------------------------------------------------------------
OVERVIEW
----------------------------------------------------------------------

The Netcode module bridges GameCreator with Unity Netcode for GameObjects.
It provides:
- NetworkCharacterAdapter: Character ↔ NetworkBehaviour bridge
- NetworkCharacter: Extended Character with network properties
- NetworkVariablesSync: Variable synchronization
- Visual Scripting components for network operations

----------------------------------------------------------------------
KEY COMPONENTS
----------------------------------------------------------------------

NetworkCharacterAdapter : NetworkBehaviour
├── Character Character - The GC Character component
├── NetworkCharacter NetworkCharacter - Extended character (if present)
├── bool IsLocalPlayer - IsOwner && Character.IsPlayer
├── OnNetworkSpawn() - Called when spawned on network
├── OnNetworkDespawn() - Called when despawned
├── RequestOwnership() - Request ownership from server
├── TransferOwnership(ulong clientId) - Server transfers ownership
└── Events: EventNetworkSpawned, EventNetworkDespawned, EventOwnershipChanged

NetworkCharacter : Character
├── bool IsNetworkSpawned - True when network spawned
├── BecomeLocalPlayer() - Set up as local player
└── BecomeRemotePlayer() - Set up as remote player

NetworkVariablesSync : NetworkBehaviour
├── SetVariable(string name, string value)
├── GetVariable(string name) → string
├── SetFloat/GetFloat, SetInt/GetInt, SetBool/GetBool
├── NetworkSyncMode: Everyone, OwnerOnly, ServerOnly
└── Event: EventVariableChanged

----------------------------------------------------------------------
SPAWN LIFECYCLE
----------------------------------------------------------------------

```csharp
public override void OnNetworkSpawn()
{
    base.OnNetworkSpawn();
    
    // NetworkCharacter flag is set automatically
    // networkCharacter.IsNetworkSpawned = true;
    
    if (IsOwner)
    {
        // LOCAL PLAYER
        networkCharacter.BecomeLocalPlayer();
        // Sets IsPlayer = true
    }
    else
    {
        // REMOTE PLAYER
        networkCharacter.BecomeRemotePlayer();
    }
}

public override void OnNetworkDespawn()
{
    // Cleanup
    // networkCharacter.IsNetworkSpawned = false;
    base.OnNetworkDespawn();
}
```

----------------------------------------------------------------------
RPC PATTERNS (NETCODE 2.x)
----------------------------------------------------------------------

NEW SYNTAX (PREFERRED):
```csharp
// Client → Server
[Rpc(SendTo.Server)]
private void DoActionServerRpc() { }

// Server → All Clients
[Rpc(SendTo.Everyone)]
private void NotifyClientsRpc() { }

// With sender info (non-owner can call)
[Rpc(SendTo.Server, RequireOwnership = false)]
private void RequestRpc(RpcParams rpcParams = default)
{
    ulong senderId = rpcParams.Receive.SenderClientId;
}
```

AVAILABLE SendTo OPTIONS:
- SendTo.Server - Client → Server
- SendTo.Everyone - Server → All Clients
- SendTo.Owner - Server → Owner only
- SendTo.NotOwner - Server → Non-owners
- SendTo.ClientsAndHost - Server → Clients + Host
- SendTo.Me - Self only

----------------------------------------------------------------------
NETWORKVARIABLESSYNC USAGE
----------------------------------------------------------------------

```csharp
// Configuration in Inspector
[Serializable]
public class SyncedVariableConfig
{
    public string variableName;
    public NetworkSyncMode syncMode = NetworkSyncMode.Everyone;
    public float syncRate = 10f; // Hz
}

// Runtime usage
networkVariablesSync.SetFloat("health", 100f);
networkVariablesSync.SetInt("score", 50);
networkVariablesSync.SetBool("isReady", true);

float health = networkVariablesSync.GetFloat("health", defaultValue);

// Subscribe to changes
networkVariablesSync.EventVariableChanged += (name, value) =>
{
    Debug.Log($"{name} changed to {value}");
};
```

----------------------------------------------------------------------
VISUAL SCRIPTING COMPONENTS
----------------------------------------------------------------------

INSTRUCTIONS:
├── InstructionNetworkStartHost - Start as host
├── InstructionNetworkStartClient - Connect as client
├── InstructionNetworkSpawnPlayer - Spawn player character
├── InstructionNetworkDespawn - Despawn network object
├── InstructionNetworkChangeOwnership - Transfer ownership
└── InstructionNetworkDisconnect - Disconnect from network

CONDITIONS:
├── ConditionNetworkIsHost - True if host
├── ConditionNetworkIsClient - True if client
├── ConditionNetworkIsServer - True if server
├── ConditionNetworkIsOwner - True if owner of object
├── ConditionNetworkIsLocalPlayer - True if local player
├── ConditionNetworkIsConnected - True if connected
└── ConditionNetworkIsSpawned - True if network spawned

TRIGGERS:
├── EventNetworkOnClientConnected - Client connected
├── EventNetworkOnClientDisconnected - Client disconnected
├── EventNetworkOnLocalPlayerSpawned - Local player spawned
├── EventNetworkOnNetworkSpawn - Object spawned
├── EventNetworkOnNetworkDespawn - Object despawned
└── EventNetworkOnOwnershipChanged - Ownership changed

PROPERTIES:
├── GetGameObjectNetworkLocalPlayer - Get local player GO
└── GetGameObjectNetworkPlayerByClientId - Get player by ID

----------------------------------------------------------------------
OWNERSHIP PATTERNS
----------------------------------------------------------------------

```csharp
// Check ownership
if (IsOwner)
{
    // This client owns this object
}

if (IsServer)
{
    // This is the server
}

if (IsHost)
{
    // This is the host (server + client)
}

// Request ownership (from client)
networkCharacterAdapter.RequestOwnership();

// Transfer ownership (server only)
if (IsServer)
{
    networkCharacterAdapter.TransferOwnership(newOwnerClientId);
}
```

----------------------------------------------------------------------
NETWORK STRING FOR LISTS
----------------------------------------------------------------------

```csharp
// NetworkString64 for NetworkList compatibility
public struct NetworkString64 : INetworkSerializable
{
    private FixedString64Bytes m_Value;
    
    public NetworkString64(string value) { ... }
    public void NetworkSerialize<T>(BufferSerializer<T> serializer) { ... }
    public override string ToString() => m_Value.ToString();
}

// Usage in NetworkList
private NetworkList<NetworkString64> m_Values;
```

----------------------------------------------------------------------
RELATED FILES
----------------------------------------------------------------------

- .serena/personas/character-core.llm.txt (Core Character)
- .serena/memories/critical_rules.md (Patterns reference)
- openspec/specs/network-synchronization/spec.md (Requirements)
- openspec/.decision-trees/gc-character-sync.yaml (Decision tree)
